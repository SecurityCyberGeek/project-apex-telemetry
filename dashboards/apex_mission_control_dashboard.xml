#  Copyright 2026 Timothy D. Harmon
#
#  Licensed under the Apache License, Version 2.0 (the "License");
#  you may not use this file except in compliance with the License.
#  You may obtain a copy of the License at
#
#      http://www.apache.org/licenses/LICENSE-2.0
#
#  Unless required by applicable law or agreed to in writing, software
#  distributed under the License is distributed on an "AS IS" BASIS,
#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
#  See the License for the specific language governing permissions and
#  limitations under the License.

{
    "title": "Project Apex: Mission Control (MCL40)",
    "description": "Real-Time Active Aero Validation & Thermal Compliance Engine",
    "inputs": {
        "input_GlobalTime": {
            "options": {
                "defaultValue": "rt-30s,rt",
                "token": "time_token"
            },
            "title": "Analysis Window",
            "type": "input.timerange"
        }
    },
    "defaults": {
        "dataSources": {
            "ds.search": {
                "options": {
                    "queryParameters": {
                        "earliest": "$time_token.earliest$",
                        "latest": "$time_token.latest$"
                    }
                }
            }
        }
    },
    "visualizations": {
        "viz_EventStream": {
            "context": {
                "compliance_status_colors": [
                    {
                        "match": "CRITICAL: TORQUE_ANOMALY",
                        "value": "#DC4E41"
                    },
                    {
                        "match": "VIOLATION_RISK",
                        "value": "#F8BE34"
                    },
                    {
                        "match": "LEGAL",
                        "value": "#53A051"
                    }
                ]
            },
            "dataSources": {
                "primary": "ds_EventStream"
            },
            "options": {
                "count": 10,
                "dataOverlayMode": "none",
                "drilldown": "none",
                "tableFormat": {
                    "rowBackgroundColors": "> table | seriesByName(\"compliance_status\") | matchValue(compliance_status_colors)"
                }
            },
            "title": "Event Stream (Compliance Log)",
            "type": "splunk.table"
        },
        "viz_PlatformStatus": {
            "dataSources": {
                "primary": "ds_PlatformStatus"
            },
            "options": {
                "majorColor": "> majorValue | rangeValue(majorColorConfig)",
                "majorColorConfig": [
                    {
                        "to": 80,
                        "value": "#53A051"
                    },
                    {
                        "from": 80,
                        "to": 100,
                        "value": "#F8BE34"
                    },
                    {
                        "from": 100,
                        "value": "#DC4E41"
                    }
                ],
                "sparklineDisplay": "off",
                "trendColor": "> trendValue | rangeValue(trendColorConfig)",
                "underLabel": "Vertical Energy (Joules)"
            },
            "title": "Aero Platform Status",
            "type": "splunk.singlevalue"
        },
        "viz_SpeedTrace": {
            "dataSources": {
                "primary": "ds_SpeedTrace"
            },
            "options": {
                "seriesColors": [
                    "#FF8000",
                    "#00A0FF"
                ],
                "xAxisTitleVisibility": "hide",
                "yAxisTitleText": "Speed (KPH)"
            },
            "title": "Live Speed Telemetry (Head-to-Head)",
            "type": "splunk.line"
        },
        "viz_ThermalScatter": {
            "dataSources": {
                "primary": "ds_ThermalScatter"
            },
            "options": {
                "seriesColors": [
                    "#DC4E41"
                ],
                "xAxisTitleText": "Engine Temp (Â°C)",
                "yAxisTitleText": "Platform Compression (mm)"
            },
            "showLastUpdated": false,
            "showProgressBar": false,
            "title": "Transient Torque Anomaly Detected",
            "type": "splunk.scatter"
        }
    },
    "dataSources": {
        "ds_EventStream": {
            "name": "Event Stream Search",
            "options": {
                "query": "index=\"project_apex\" sourcetype=\"mcl_telemetry\" \n| table _time, car_id, speed_kph, vertical_energy, engine_temp_c, compliance_status \n| sort - _time",
                "queryParameters": {
                    "earliest": "$time_token.earliest$",
                    "latest": "$time_token.latest$"
                }
            },
            "type": "ds.search"
        },
        "ds_PlatformStatus": {
            "name": "Platform Status Search",
            "options": {
                "query": "index=\"project_apex\" sourcetype=\"mcl_telemetry\" \n| stats max(vertical_energy) as majorValue",
                "queryParameters": {
                    "earliest": "$time_token.earliest$",
                    "latest": "$time_token.latest$"
                }
            },
            "type": "ds.search"
        },
        "ds_SpeedTrace": {
            "name": "Speed Trace Search",
            "options": {
                "query": "index=\"project_apex\" sourcetype=\"mcl_telemetry\" \n| timechart span=1s avg(speed_kph) by car_id",
                "queryParameters": {
                    "earliest": "$time_token.earliest$",
                    "latest": "$time_token.latest$"
                }
            },
            "type": "ds.search"
        },
        "ds_ThermalCheck": {
            "name": "Thermal Threat Scanner",
            "options": {
                "query": "index=\"project_apex\" \n| stats max(engine_temp_c) as peak_temp max(vertical_energy) as peak_energy \n| where peak_temp > 105 AND peak_energy > 80",
                "queryParameters": {
                    "earliest": "$time_token.earliest$",
                    "latest": "$time_token.latest$"
                }
            },
            "type": "ds.search"
        },
        "ds_ThermalScatter": {
            "name": "Thermal Scatter Search",
            "options": {
                "query": "index=\"project_apex\" sourcetype=\"mcl_telemetry\" \n| table engine_temp_c, rear_rh_mm",
                "queryParameters": {
                    "earliest": "$time_token.earliest$",
                    "latest": "$time_token.latest$"
                }
            },
            "type": "ds.search"
        }
    },
    "layout": {
        "globalInputs": [
            "input_GlobalTime"
        ],
        "layoutDefinitions": {
            "layout_1": {
                "options": {
                    "height": 960,
                    "width": 1440
                },
                "structure": [
                    {
                        "item": "viz_PlatformStatus",
                        "position": {
                            "h": 300,
                            "w": 400,
                            "x": 0,
                            "y": 0
                        },
                        "type": "block"
                    },
                    {
                        "item": "viz_SpeedTrace",
                        "position": {
                            "h": 300,
                            "w": 1040,
                            "x": 400,
                            "y": 0
                        },
                        "type": "block"
                    },
                    {
                        "item": "viz_EventStream",
                        "position": {
                            "h": 660,
                            "w": 720,
                            "x": 0,
                            "y": 300
                        },
                        "type": "block"
                    },
                    {
                        "item": "viz_ThermalScatter",
                        "position": {
                            "h": 660,
                            "w": 720,
                            "x": 720,
                            "y": 300
                        },
                        "type": "block"
                    }
                ],
                "type": "grid"
            }
        },
        "tabs": {
            "items": [
                {
                    "label": "New tab",
                    "layoutId": "layout_1"
                }
            ]
        }
    }
}
