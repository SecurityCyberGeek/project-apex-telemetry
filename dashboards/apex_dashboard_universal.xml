<dashboard version="1.1" theme="dark">
  <label>Project Apex: Mission Control (Dual Telemetry)</label>
  <description>Live Telemetry Validation // Car: MCL60-Sim // Track: Silverstone</description>
  
  <!-- ROW 1: HEADS UP DISPLAY -->
  <row>
    <panel>
      <title>Aero Stability Status (System)</title>
      <single>
        <search>
          <!-- QUERY: Finds "status" field in raw text -->
          <query>index=* "ProjectApex" 
| rex field=_raw "\"status\"\s*:\s*\"(?&lt;status&gt;[^\"]+)\"" 
| stats latest(status) as status 
| eval status_color=if(status=="STABLE", "OK", "CRITICAL") 
| table status</query>
          <earliest>rt-30s</earliest>
          <latest>rt</latest>
          <refresh>1s</refresh>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="rangeColors">["0x53a051","0xdc4e41"]</option>
        <option name="rangeValues">[0]</option>
        <option name="useColors">1</option>
        <option name="showSparkline">0</option> 
        <option name="height">150</option>
      </single>
    </panel>
    
    <panel>
      <title>Live Speed (Head-to-Head)</title>
      <!-- LANDO'S GAUGE (CAR_1) -->
      <single>
         <title>Lando (CAR_1)</title>
         <search>
          <!-- QUERY: Regex extraction for CAR_1 Speed -->
          <query>index=* "ProjectApex" "CAR_1"
| rex field=_raw "\"speed_kph\"\s*:\s*(?&lt;speed_kph&gt;[\d\.]+)" 
| eval speed_kph=round(tonumber(speed_kph), 0) 
| stats latest(speed_kph) as speed_kph 
| table speed_kph</query>
          <earliest>rt-5s</earliest>
          <latest>rt</latest>
          <refresh>1s</refresh>
        </search>
        <option name="numberPrecision">0</option>
        <option name="colorMode">none</option>
        <option name="underLabel">KPH</option>
        <option name="showSparkline">0</option>
        <option name="height">150</option>
      </single>
      
      <!-- OSCAR'S GAUGE (CAR_81) -->
      <single>
         <title>Oscar (CAR_81)</title>
         <search>
          <!-- QUERY: Regex extraction for CAR_81 Speed -->
          <query>index=* "ProjectApex" "CAR_81"
| rex field=_raw "\"speed_kph\"\s*:\s*(?&lt;speed_kph&gt;[\d\.]+)" 
| eval speed_kph=round(tonumber(speed_kph), 0) 
| stats latest(speed_kph) as speed_kph 
| table speed_kph</query>
          <earliest>rt-5s</earliest>
          <latest>rt</latest>
          <refresh>1s</refresh>
        </search>
        <option name="numberPrecision">0</option>
        <option name="colorMode">none</option>
        <option name="underLabel">KPH</option>
        <option name="showSparkline">0</option>
        <option name="height">150</option>
      </single>
    </panel>

    <panel>
      <title>Current Oscillation Energy</title>
      <chart>
        <search>
          <!-- QUERY: Regex extraction for energy -->
          <query>index=* "ProjectApex" 
| rex field=_raw "\"oscillation_energy\"\s*:\s*(?&lt;oscillation_energy&gt;[\d\.]+)" 
| eval energy=tonumber(oscillation_energy) 
| stats max(energy) as energy</query>
          <earliest>rt-5s</earliest>
          <latest>rt</latest>
          <refresh>1s</refresh>
        </search>
        <option name="charting.chart">radialGauge</option>
        <option name="charting.chart.style">minimal</option>
        <option name="charting.chart.rangeValues">[0,50,100,500]</option>
        <option name="charting.gaugeColors">["0x53a051","0xFF8000","0xdc4e41"]</option>
        <option name="height">180</option>
      </chart>
    </panel>
  </row>

  <!-- ROW 2: DEEP DIVE ANALYTICS -->
  <row>
    <panel>
      <title>Porpoising Detector (Energy > 100J = Violation)</title>
      <chart>
        <search>
          <!-- QUERY: Graph Lando's Oscillation Energy over time -->
          <query>index=* "ProjectApex" "CAR_1"
| rex field=_raw "\"oscillation_energy\"\s*:\s*(?&lt;oscillation_energy&gt;[\d\.]+)" 
| eval oscillation_energy=tonumber(oscillation_energy) 
| timechart span=250ms max(oscillation_energy) as "Vertical Energy" 
| eval Threshold=100</query>
          <earliest>rt-1m</earliest>
          <latest>rt</latest>
          <refresh>1s</refresh>
        </search>
        <option name="charting.chart">area</option>
        <option name="charting.chart.overlayFields">Threshold</option>
        <option name="charting.axisTitleY.text">Energy (J)</option>
        <option name="charting.axisTitleX.text">Time (Live)</option>
        <option name="charting.seriesColors">["0xFF8000", "0xFF0000"]</option> 
        <option name="charting.legend.placement">top</option>
        <option name="height">300</option>
      </chart>
    </panel>
  </row>

  <!-- ROW 3: DEBUGGER / LOGS -->
  <row>
    <panel>
      <title>Live Event Stream (All Data)</title>
      <table>
        <search>
          <!-- QUERY: Robust Regex extraction for table population -->
          <query>index=* "ProjectApex" 
| rex field=_raw "\"car_id\"\s*:\s*\"(?&lt;car_id&gt;[^\"]+)\"" 
| rex field=_raw "\"speed_kph\"\s*:\s*(?&lt;speed_kph&gt;[\d\.]+)" 
| rex field=_raw "\"oscillation_energy\"\s*:\s*(?&lt;oscillation_energy&gt;[\d\.]+)" 
| rex field=_raw "\"message\"\s*:\s*\"(?&lt;message&gt;[^\"]+)\"" 
| eval speed_kph=round(tonumber(speed_kph), 0) 
| eval oscillation_energy=round(tonumber(oscillation_energy), 2) 
| table _time, car_id, speed_kph, oscillation_energy, message 
| rename oscillation_energy as "Energy (J)", speed_kph as "Speed (KPH)" 
| sort -_time</query>
          <earliest>rt-5m</earliest>
          <latest>rt</latest>
        </search>
        <option name="count">10</option>
        <option name="drilldown">none</option>
        <format type="color" field="Energy (J)">
          <colorPalette type="minMidMax" maxColor="#DC4E41" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
      </table>
    </panel>
  </row>
</dashboard>